<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Candy 3Då¯¼èˆª</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- å¼•å…¥SheetJSåº“ç”¨äºè¯»å–Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  
  <!-- å¼•å…¥GSAPåŠ¨ç”»åº“ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary-color: #667eea;
      --secondary-color: #764ba2;
      --accent-pink: #FF6B8B;
      --accent-purple: #A777E3;
      --accent-blue: #6BBBF7;
      --accent-green: #6BDE98;
      --accent-yellow: #FFD166;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      min-height: 100vh;
      overflow-x: hidden;
      color: white;
      perspective: 1000px;
    }
    
    /* 3Då¡ç‰‡æ•ˆæœ */
    .card-3d {
      transform-style: preserve-3d;
      transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
      position: relative;
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 
        0 20px 40px rgba(0,0,0,0.3),
        inset 0 1px 0 rgba(255,255,255,0.1);
    }
    
    .card-3d:hover {
      transform: translateY(-15px) rotateX(10deg) rotateY(5deg);
      box-shadow: 
        0 30px 60px rgba(0,0,0,0.4),
        0 0 20px rgba(102, 126, 234, 0.3),
        inset 0 1px 0 rgba(255,255,255,0.2);
    }
    
    .card-3d::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, 
        rgba(255,255,255,0.1) 0%, 
        rgba(255,255,255,0) 60%);
      border-radius: inherit;
      opacity: 0;
      transition: opacity 0.6s;
      pointer-events: none;
    }
    
    .card-3d:hover::before {
      opacity: 1;
    }
    
    /* æµ®åŠ¨åŠ¨ç”» */
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      33% { transform: translateY(-20px) rotate(120deg); }
      66% { transform: translateY(10px) rotate(240deg); }
    }
    
    @keyframes float2 {
      0%, 100% { transform: translate(0px, 0px) scale(1); }
      33% { transform: translate(20px, -20px) scale(1.1); }
      66% { transform: translate(-20px, 10px) scale(0.9); }
    }
    
    @keyframes float3 {
      0%, 100% { transform: translate(0px, 0px); }
      50% { transform: translate(10px, -10px); }
    }
    
    /* ç²’å­åŠ¨ç”» */
    .particle {
      position: fixed;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
      pointer-events: none;
      z-index: -1;
      opacity: 0.4;
    }
    
    /* éœ“è™¹æ•ˆæœ */
    .neon-text {
      text-shadow: 
        0 0 10px rgba(102, 126, 234, 0.7),
        0 0 20px rgba(102, 126, 234, 0.5),
        0 0 30px rgba(102, 126, 234, 0.3);
    }
    
    .neon-border {
      border: 2px solid rgba(102, 126, 234, 0.3);
      box-shadow: 
        0 0 20px rgba(102, 126, 234, 0.2),
        inset 0 0 20px rgba(102, 126, 234, 0.1);
    }
    
    /* 3DæŒ‰é’®æ•ˆæœ */
    .btn-3d {
      position: relative;
      transform-style: preserve-3d;
      transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
      background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
      border: none;
      overflow: hidden;
    }
    
    .btn-3d::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    
    .btn-3d:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 
        0 10px 20px rgba(0,0,0,0.3),
        0 0 10px rgba(255,107,139,0.5);
    }
    
    .btn-3d:hover::before {
      left: 100%;
    }
    
    .btn-3d:active {
      transform: translateY(1px) scale(0.98);
    }
    
    /* åŠ è½½åŠ¨ç”» */
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 3px solid rgba(255,255,255,0.1);
      border-radius: 50%;
      border-top-color: var(--accent-pink);
      border-right-color: var(--accent-purple);
      border-bottom-color: var(--accent-blue);
      animation: spin 1.5s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* è„‰å†²æ•ˆæœ */
    @keyframes pulse {
      0%, 100% { 
        opacity: 1;
        box-shadow: 0 0 0 0 rgba(255,107,139,0.7);
      }
      50% { 
        opacity: 0.8;
        box-shadow: 0 0 0 10px rgba(255,107,139,0);
      }
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    /* 3Dæ ‡é¢˜æ•ˆæœ */
    .title-3d {
      text-shadow: 
        2px 2px 0 var(--accent-purple),
        4px 4px 0 rgba(0,0,0,0.2);
    }
    
    /* è¿›åº¦æ¡æ•ˆæœ */
    .progress-bar {
      height: 4px;
      background: linear-gradient(90deg, var(--accent-pink), var(--accent-purple), var(--accent-blue));
      border-radius: 2px;
      position: relative;
      overflow: hidden;
    }
    
    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: progress 2s infinite;
    }
    
    @keyframes progress {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    /* æ»šåŠ¨æ¡ç¾åŒ– */
    ::-webkit-scrollbar {
      width: 10px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
    }
    
    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 768px) {
      .card-3d:hover {
        transform: translateY(-10px) rotateX(5deg);
      }
      
      .btn-3d:hover {
        transform: translateY(-2px) scale(1.02);
      }
    }
    
    /* æ‰“å­—æœºæ•ˆæœ */
    .typing-text::after {
      content: '|';
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }
    
    /* 3Då›¾æ ‡æ•ˆæœ */
    .icon-3d {
      transform-style: preserve-3d;
      transition: transform 0.6s;
    }
    
    .icon-3d:hover {
      transform: rotateY(180deg) scale(1.2);
    }
    
    /* å‘å…‰æ•ˆæœ */
    .glow {
      filter: drop-shadow(0 0 10px currentColor);
    }
    
    /* ç½‘æ ¼èƒŒæ™¯ */
    .grid-bg {
      background-image: 
        linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
      background-size: 50px 50px;
      background-position: center center;
    }
  </style>
</head>

<body class="relative overflow-x-hidden">
  
  <!-- èƒŒæ™¯è£…é¥° -->
  <div class="fixed inset-0 z-0">
    <div class="absolute top-1/4 left-1/4 w-64 h-64 rounded-full bg-gradient-to-r from-purple-500/10 to-pink-500/10 blur-3xl animate-float"></div>
    <div class="absolute bottom-1/4 right-1/4 w-96 h-96 rounded-full bg-gradient-to-r from-blue-500/10 to-cyan-500/10 blur-3xl animate-float2"></div>
    <div class="absolute top-3/4 left-3/4 w-48 h-48 rounded-full bg-gradient-to-r from-green-500/10 to-yellow-500/10 blur-3xl animate-float3"></div>
  </div>
  
  <!-- ç²’å­å®¹å™¨ -->
  <div id="particles-container"></div>
  
  <!-- ä¸»å®¹å™¨ -->
  <div class="container mx-auto px-4 py-8 relative z-10">
    
    <!-- 3Dæ ‡é¢˜åŒºåŸŸ -->
    <header class="mb-12 text-center relative">
      <div class="inline-block mb-8">
        <div class="w-24 h-24 mx-auto mb-6 relative">
          <div class="absolute inset-0 bg-gradient-to-r from-pink-500 to-purple-500 rounded-2xl transform rotate-45"></div>
          <div class="absolute inset-2 bg-gray-900 rounded-xl transform rotate-45 flex items-center justify-center">
            <i class="fa fa-candy-cane text-4xl" style="color: #FF6B8B; transform: rotate(-45deg);"></i>
          </div>
        </div>
        <h1 class="text-5xl md:text-6xl font-bold mb-4 title-3d">
          <span class="bg-gradient-to-r from-pink-400 via-purple-400 to-blue-400 bg-clip-text text-transparent">
            Candy 3Då¯¼èˆª
          </span>
        </h1>
        <p class="text-xl opacity-80 typing-text">æ¢ç´¢ç‚«é…·çš„3Dç½‘å€å¯¼èˆªä¸–ç•Œ</p>
      </div>
      
      <!-- è¿›åº¦æ¡ -->
      <div class="max-w-2xl mx-auto mt-8">
        <div class="progress-bar"></div>
      </div>
    </header>
    
    <div class="flex flex-col lg:flex-row gap-8">
      
      <!-- å·¦ä¾§3Då¯¼èˆªæ  -->
      <aside class="lg:w-1/4">
        <div class="card-3d rounded-3xl p-6 mb-6">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold flex items-center">
              <i class="fa fa-cubes mr-3 glow" style="color: #FF6B8B;"></i>
              <span class="neon-text">åˆ†ç±»å¯¼èˆª</span>
            </h2>
            <button id="toggle-3d" class="btn-3d rounded-full p-3" title="åˆ‡æ¢3Dæ¨¡å¼">
              <i class="fa fa-cube"></i>
            </button>
          </div>
          
          <!-- æœç´¢æ¡† -->
          <div class="relative mb-6">
            <input type="text" id="search-input" placeholder="æœç´¢ç½‘ç«™..." 
                   class="w-full pl-12 pr-4 py-3 rounded-xl bg-gray-900/50 border border-gray-700 focus:outline-none focus:border-pink-500 focus:ring-2 focus:ring-pink-500/30 transition-all">
            <i class="fa fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
          </div>
          
          <!-- åˆ†ç±»åˆ—è¡¨ -->
          <div class="max-h-[400px] overflow-y-auto pr-2" id="category-container">
            <ul id="category-list" class="space-y-2">
              <!-- åˆ†ç±»å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </ul>
          </div>
          
          <!-- ç»Ÿè®¡ä¿¡æ¯ -->
          <div class="mt-6 pt-6 border-t border-gray-700">
            <div class="grid grid-cols-2 gap-4 text-sm">
              <div class="text-center p-4 rounded-xl bg-gray-900/50">
                <div class="text-2xl font-bold text-pink-400 mb-1" id="total-sites">0</div>
                <div class="text-gray-300">æ€»ç½‘ç«™</div>
              </div>
              <div class="text-center p-4 rounded-xl bg-gray-900/50">
                <div class="text-2xl font-bold text-purple-400 mb-1" id="total-categories">0</div>
                <div class="text-gray-300">åˆ†ç±»æ•°</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- å¿«æ·æ“ä½œ -->
        <div class="card-3d rounded-3xl p-6">
          <h3 class="text-lg font-bold mb-4 flex items-center">
            <i class="fa fa-bolt mr-3 glow" style="color: #FFD166;"></i>
            å¿«æ·æ“ä½œ
          </h3>
          <div class="space-y-3">
            <button id="refresh-btn" class="w-full flex items-center justify-center py-3 rounded-xl bg-gray-900/50 hover:bg-gray-800/50 transition-colors btn-3d">
              <i class="fa fa-sync-alt mr-3"></i>
              åˆ·æ–°æ•°æ®
            </button>
            <button id="favorites-btn" class="w-full flex items-center justify-center py-3 rounded-xl bg-gray-900/50 hover:bg-gray-800/50 transition-colors btn-3d relative">
              <i class="fa fa-star mr-3" style="color: #FFD166;"></i>
              æˆ‘çš„æ”¶è—
              <span id="favorites-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center">0</span>
            </button>
            <button id="toggle-effects" class="w-full flex items-center justify-center py-3 rounded-xl bg-gray-900/50 hover:bg-gray-800/50 transition-colors btn-3d">
              <i class="fa fa-magic mr-3"></i>
              ç‰¹æ•ˆå¼€å…³
            </button>
          </div>
        </div>
      </aside>
      
      <!-- å³ä¾§3Dç½‘ç«™å±•ç¤ºåŒº -->
      <section class="lg:w-3/4">
        <!-- æ§åˆ¶æ  -->
        <div class="card-3d rounded-3xl p-6 mb-6 flex flex-wrap justify-between items-center">
          <div>
            <h2 id="category-title" class="text-2xl font-bold flex items-center">
              <i class="fa fa-globe mr-3 glow" style="color: #6BBBF7;"></i>
              æ‰€æœ‰ç½‘ç«™
            </h2>
            <p class="text-gray-300 mt-1">å…± <span id="display-count" class="font-bold text-white">0</span> ä¸ªç½‘ç«™</p>
          </div>
          
          <div class="flex items-center space-x-4 mt-4 lg:mt-0">
            <!-- æ’åº -->
            <div class="relative">
              <select id="sort-select" class="appearance-none bg-gray-900/50 rounded-xl px-4 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-pink-500/30 border border-gray-700">
                <option value="name-asc">åç§°æ’åº</option>
                <option value="name-desc">åç§°å€’åº</option>
                <option value="random">éšæœºæ’åº</option>
              </select>
              <i class="fa fa-sort absolute right-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
            </div>
            
            <!-- è§†å›¾åˆ‡æ¢ -->
            <div class="flex bg-gray-900/50 rounded-xl p-1">
              <button class="view-toggle px-3 py-2 rounded-lg transition-colors bg-gray-800" data-view="grid">
                <i class="fa fa-th-large"></i>
              </button>
              <button class="view-toggle px-3 py-2 rounded-lg transition-colors" data-view="list">
                <i class="fa fa-list"></i>
              </button>
              <button class="view-toggle px-3 py-2 rounded-lg transition-colors" data-view="compact">
                <i class="fa fa-th"></i>
              </button>
            </div>
          </div>
        </div>
        
        <!-- ç½‘ç«™ç½‘æ ¼ -->
        <div id="website-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- ç½‘ç«™å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
          <div class="col-span-full flex justify-center items-center py-20">
            <div class="text-center">
              <div class="loading-spinner mx-auto mb-6"></div>
              <p class="text-lg mb-2">æ­£åœ¨åŠ è½½3Dä¸–ç•Œ...</p>
              <p class="text-gray-400">è¯·ç¨å€™</p>
            </div>
          </div>
        </div>
        
        <!-- åˆ†é¡µ -->
        <div id="pagination" class="mt-8 flex justify-center items-center space-x-4 hidden">
          <button id="prev-page" class="btn-3d rounded-xl px-6 py-3 disabled:opacity-50 disabled:cursor-not-allowed">
            <i class="fa fa-chevron-left mr-2"></i>ä¸Šä¸€é¡µ
          </button>
          <div class="bg-gray-900/50 rounded-xl px-6 py-3">
            ç¬¬ <span id="current-page" class="font-bold">1</span> / <span id="total-pages" class="font-bold">1</span> é¡µ
          </div>
          <button id="next-page" class="btn-3d rounded-xl px-6 py-3 disabled:opacity-50 disabled:cursor-not-allowed">
            ä¸‹ä¸€é¡µ<i class="fa fa-chevron-right ml-2"></i>
          </button>
        </div>
      </section>
    </div>
  </div>
  
  <!-- æ”¶è—å¤¹æ¨¡æ€æ¡† -->
  <div id="favorites-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeFavorites()"></div>
    <div class="relative card-3d rounded-3xl w-full max-w-4xl max-h-[80vh] flex flex-col transform scale-95 transition-transform duration-300">
      <div class="p-6 border-b border-gray-700 flex justify-between items-center">
        <h3 class="text-2xl font-bold flex items-center">
          <i class="fa fa-star mr-3 glow" style="color: #FFD166;"></i>
          æˆ‘çš„æ”¶è—
        </h3>
        <button onclick="closeFavorites()" class="btn-3d rounded-full p-3">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <div id="favorites-container" class="p-6 overflow-y-auto flex-grow">
        <!-- æ”¶è—å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        <div class="text-center py-12">
          <i class="fa fa-star text-5xl mb-4" style="color: rgba(255,255,255,0.1);"></i>
          <p class="text-gray-300 mb-2">æ‚¨è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•ç½‘ç«™</p>
          <p class="text-sm text-gray-400">ç‚¹å‡»ç½‘ç«™å¡ç‰‡ä¸Šçš„æ˜Ÿæ˜Ÿå›¾æ ‡æ·»åŠ æ”¶è—</p>
        </div>
      </div>
      <div class="p-4 border-t border-gray-700 text-center">
        <button id="clear-favorites" class="btn-3d rounded-xl px-6 py-3 bg-red-500/20 hover:bg-red-500/30 text-red-400 transition-colors">
          <i class="fa fa-trash mr-2"></i>æ¸…ç©ºæ”¶è—å¤¹
        </button>
      </div>
    </div>
  </div>
  
  <!-- åº•éƒ¨ä¿¡æ¯ -->
  <footer class="mt-12 pt-8 border-t border-gray-700 text-center text-gray-300">
    <div class="container mx-auto px-4">
      <p class="mb-4">Candy 3Då¯¼èˆª &copy; 2025 | æ¢ç´¢ç‚«é…·çš„ç½‘å€å¯¼èˆªä½“éªŒ</p>
      <p class="text-sm opacity-75">æ•°æ®æ¥æºï¼šç½‘ç«™å¯¼èˆª.xlsx | ä½¿ç”¨CSS 3D Transformæ„å»ºæ•ˆæœ</p>
    </div>
  </footer>

  <script>
    // å…¨å±€å˜é‡
    let allWebsites = [];
    let filteredWebsites = [];
    let currentCategory = 'all';
    let favorites = JSON.parse(localStorage.getItem('candyFavorites')) || [];
    let currentPage = 1;
    let itemsPerPage = 12;
    let currentView = 'grid';
    let is3DEffects = true;
    
    // ç³–æœé¢œè‰²æ± 
    const candyColors = [
      '#FF6B8B', '#A777E3', '#6BBBF7', '#6BDE98', '#FFD166', 
      '#FF9F45', '#EF476F', '#9D4EDD', '#00BBF9', '#00F5D4'
    ];
    
    // DOMå…ƒç´ 
    const categoryListEl = document.getElementById('category-list');
    const websiteContainerEl = document.getElementById('website-container');
    const categoryTitleEl = document.getElementById('category-title');
    const displayCountEl = document.getElementById('display-count');
    const searchInputEl = document.getElementById('search-input');
    const favoritesBtn = document.getElementById('favorites-btn');
    const favoritesCountEl = document.getElementById('favorites-count');
    const favoritesModal = document.getElementById('favorites-modal');
    const favoritesContainer = document.getElementById('favorites-container');
    const clearFavoritesBtn = document.getElementById('clear-favorites');
    const sortSelectEl = document.getElementById('sort-select');
    const viewToggles = document.querySelectorAll('.view-toggle');
    const refreshBtn = document.getElementById('refresh-btn');
    const totalSitesEl = document.getElementById('total-sites');
    const totalCategoriesEl = document.getElementById('total-categories');
    const toggle3dBtn = document.getElementById('toggle-3d');
    const toggleEffectsBtn = document.getElementById('toggle-effects');
    const paginationEl = document.getElementById('pagination');
    const prevPageBtn = document.getElementById('prev-page');
    const nextPageBtn = document.getElementById('next-page');
    const currentPageEl = document.getElementById('current-page');
    const totalPagesEl = document.getElementById('total-pages');
    
    // åˆ›å»ºCSSç²’å­æ•ˆæœ
    function createParticles() {
      const container = document.getElementById('particles-container');
      const particleCount = 50;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        // éšæœºå¤§å°
        const size = Math.random() * 20 + 5;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        
        // éšæœºä½ç½®
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.top = `${Math.random() * 100}%`;
        
        // éšæœºé¢œè‰²
        const color1 = candyColors[Math.floor(Math.random() * candyColors.length)];
        const color2 = candyColors[Math.floor(Math.random() * candyColors.length)];
        particle.style.background = `linear-gradient(135deg, ${color1}, ${color2})`;
        
        // éšæœºåŠ¨ç”»
        const duration = Math.random() * 20 + 10;
        const delay = Math.random() * 5;
        const animation = Math.random() > 0.5 ? 'float' : Math.random() > 0.5 ? 'float2' : 'float3';
        
        particle.style.animation = `${animation} ${duration}s ease-in-out ${delay}s infinite`;
        particle.style.opacity = Math.random() * 0.3 + 0.1;
        
        container.appendChild(particle);
      }
    }
    
    // æ·»åŠ 3Dé¼ æ ‡äº¤äº’æ•ˆæœ
    function add3DMouseEffects() {
      if (!is3DEffects) return;
      
      const cards = document.querySelectorAll('.card-3d');
      
      cards.forEach(card => {
        card.addEventListener('mousemove', (e) => {
          if (!is3DEffects) return;
          
          const rect = card.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          
          const centerX = rect.width / 2;
          const centerY = rect.height / 2;
          
          const rotateY = ((x - centerX) / centerX) * 10;
          const rotateX = ((centerY - y) / centerY) * 10;
          const translateZ = 20;
          
          card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateZ(${translateZ}px)`;
        });
        
        card.addEventListener('mouseleave', () => {
          if (!is3DEffects) return;
          card.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) translateZ(0px)';
        });
      });
    }
    
    // åˆ‡æ¢3Dæ•ˆæœ
    function toggle3DEffects() {
      is3DEffects = !is3DEffects;
      
      const cards = document.querySelectorAll('.card-3d');
      const particles = document.querySelectorAll('.particle');
      
      if (is3DEffects) {
        // å¼€å¯3Dæ•ˆæœ
        cards.forEach(card => {
          card.style.transition = 'transform 0.6s cubic-bezier(0.23, 1, 0.32, 1)';
        });
        
        particles.forEach(particle => {
          particle.style.animationPlayState = 'running';
        });
        
        showToast('3Dæ•ˆæœå·²å¼€å¯', 'success');
        toggleEffectsBtn.innerHTML = '<i class="fa fa-magic mr-3"></i>å…³é—­ç‰¹æ•ˆ';
      } else {
        // å…³é—­3Dæ•ˆæœ
        cards.forEach(card => {
          card.style.transform = 'none';
          card.style.transition = 'all 0.3s ease';
        });
        
        particles.forEach(particle => {
          particle.style.animationPlayState = 'paused';
        });
        
        showToast('3Dæ•ˆæœå·²å…³é—­', 'info');
        toggleEffectsBtn.innerHTML = '<i class="fa fa-magic mr-3"></i>å¼€å¯ç‰¹æ•ˆ';
      }
    }
    
    // åˆå§‹åŒ–
    async function init() {
      try {
        // åˆ›å»ºç²’å­æ•ˆæœ
        createParticles();
        
        // æ·»åŠ CSSåŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
          @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(120deg); }
            66% { transform: translateY(10px) rotate(240deg); }
          }
          
          @keyframes float2 {
            0%, 100% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(20px, -20px) scale(1.1); }
            66% { transform: translate(-20px, 10px) scale(0.9); }
          }
          
          @keyframes float3 {
            0%, 100% { transform: translate(0px, 0px); }
            50% { transform: translate(10px, -10px); }
          }
          
          .animate-float { animation: float 20s ease-in-out infinite; }
          .animate-float2 { animation: float2 25s ease-in-out infinite; }
          .animate-float3 { animation: float3 30s ease-in-out infinite; }
        `;
        document.head.appendChild(style);
        
        // åŠ è½½Excelæ•°æ®
        await loadExcelData();
        
        // æ›´æ–°æ”¶è—è®¡æ•°
        updateFavoritesCount();
        
        // æ·»åŠ äº‹ä»¶ç›‘å¬
        addEventListeners();
        
        // åˆå§‹åŠ¨ç”»
        gsap.from('header', {
          y: -50,
          opacity: 0,
          duration: 1,
          ease: 'power3.out'
        });
        
        gsap.from('aside', {
          x: -50,
          opacity: 0,
          duration: 1,
          delay: 0.2,
          ease: 'power3.out'
        });
        
        gsap.from('section', {
          x: 50,
          opacity: 0,
          duration: 1,
          delay: 0.4,
          ease: 'power3.out'
        });
        
      } catch (error) {
        console.error('åˆå§‹åŒ–å¤±è´¥:', error);
        showError('åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–æ–‡ä»¶æ ¼å¼');
      }
    }
    
    // åŠ è½½Excelæ•°æ®
    async function loadExcelData() {
      try {
        websiteContainerEl.innerHTML = `
          <div class="col-span-full flex justify-center items-center py-20">
            <div class="text-center">
              <div class="loading-spinner mx-auto mb-6"></div>
              <p class="text-lg mb-2">æ­£åœ¨åŠ è½½3Dä¸–ç•Œ...</p>
              <p class="text-gray-400">è¯·ç¨å€™</p>
            </div>
          </div>
        `;
        
        const response = await fetch('ç½‘ç«™å¯¼èˆª.xlsx');
        
        if (!response.ok) {
          throw new Error(`HTTPé”™è¯¯: ${response.status} - è¯·ç¡®ä¿"ç½‘ç«™å¯¼èˆª.xlsx"æ–‡ä»¶å­˜åœ¨`);
        }
        
        const arrayBuffer = await response.arrayBuffer();
        const workbook = XLSX.read(arrayBuffer, { type: 'array' });
        
        // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        
        // å°†å·¥ä½œè¡¨è½¬æ¢ä¸ºJSON
        const excelData = XLSX.utils.sheet_to_json(worksheet);
        
        // å¤„ç†Excelæ•°æ®
        allWebsites = excelData.map(row => {
          const name = row['åç§°'] || row['ç½‘ç«™åç§°'] || row['name'] || row['ç½‘ç«™'] || '';
          const web = row['ç½‘å€'] || row['ç½‘ç«™é“¾æ¥'] || row['url'] || row['web'] || row['é“¾æ¥'] || '';
          const type = row['åˆ†ç±»'] || row['ç±»åˆ«'] || row['type'] || row['category'] || 'æœªåˆ†ç±»';
          const remark = row['å¤‡æ³¨'] || row['æè¿°'] || row['remark'] || row['description'] || row['ä»‹ç»'] || '';
          
          return { name, web, type, remark };
        }).filter(item => item.name && item.web);
        
        if (allWebsites.length === 0) {
          throw new Error('Excelæ–‡ä»¶ä¸­æ²¡æœ‰æœ‰æ•ˆæ•°æ®');
        }
        
        filteredWebsites = [...allWebsites];
        
        // æå–æ‰€æœ‰åˆ†ç±»
        const categories = ['all', ...new Set(allWebsites.map(item => item.type))];
        
        // æ¸²æŸ“åˆ†ç±»åˆ—è¡¨
        renderCategories(categories);
        
        // ç­›é€‰å¹¶æ¸²æŸ“ç½‘ç«™
        filterAndRenderWebsites();
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        updateStats();
        
        // æ˜¾ç¤ºæˆåŠŸæç¤º
        showToast('æ•°æ®åŠ è½½æˆåŠŸï¼ğŸ‰', 'success');
        
        // æ·»åŠ 3Dé¼ æ ‡æ•ˆæœ
        setTimeout(() => {
          add3DMouseEffects();
        }, 500);
        
      } catch (error) {
        console.error('åŠ è½½Excelæ•°æ®å¤±è´¥:', error);
        
        websiteContainerEl.innerHTML = `
          <div class="col-span-full flex justify-center items-center py-20">
            <div class="text-center">
              <i class="fa fa-exclamation-triangle text-5xl mb-4" style="color: #FF6B8B;"></i>
              <p class="text-lg mb-2">æ•°æ®åŠ è½½å¤±è´¥</p>
              <p class="text-gray-300 mb-6">${error.message}</p>
              <button onclick="location.reload()" class="btn-3d rounded-xl px-6 py-3">
                é‡æ–°åŠ è½½
              </button>
            </div>
          </div>
        `;
      }
    }
    
    // æ¸²æŸ“åˆ†ç±»åˆ—è¡¨
    function renderCategories(categories) {
      categoryListEl.innerHTML = '';
      
      categories.forEach(category => {
        const li = document.createElement('li');
        const isActive = currentCategory === category;
        const color = candyColors[Math.floor(Math.random() * candyColors.length)];
        
        li.className = `category-item rounded-xl p-4 cursor-pointer transition-all duration-300 card-3d ${
          isActive ? 'bg-gradient-to-r from-pink-500/20 to-purple-500/20' : ''
        }`;
        
        li.innerHTML = `
          <div class="flex items-center">
            <div class="w-10 h-10 rounded-lg flex items-center justify-center mr-3" 
                 style="background: linear-gradient(135deg, ${color}40, ${color}20)">
              <i class="fa ${category === 'all' ? 'fa-globe' : 'fa-link'}" style="color: ${color}"></i>
            </div>
            <span class="font-medium">${category === 'all' ? 'æ‰€æœ‰ç½‘ç«™' : category}</span>
            ${isActive ? '<i class="fa fa-chevron-right ml-auto text-pink-400"></i>' : ''}
          </div>
        `;
        
        li.addEventListener('click', () => {
          currentCategory = category;
          currentPage = 1;
          
          // æ›´æ–°åˆ†ç±»æ ‡é¢˜
          categoryTitleEl.innerHTML = `
            <i class="fa fa-globe mr-3 glow" style="color: #6BBBF7;"></i>
            ${category === 'all' ? 'æ‰€æœ‰ç½‘ç«™' : category}
          `;
          
          // æ›´æ–°æ¿€æ´»çŠ¶æ€
          document.querySelectorAll('.category-item').forEach(item => {
            item.classList.remove('bg-gradient-to-r', 'from-pink-500/20', 'to-purple-500/20');
          });
          
          li.classList.add('bg-gradient-to-r', 'from-pink-500/20', 'to-purple-500/20');
          
          // ç­›é€‰å¹¶æ¸²æŸ“ç½‘ç«™
          filterAndRenderWebsites();
          
          // åŠ¨ç”»æ•ˆæœ
          gsap.to(li, {
            scale: 1.05,
            duration: 0.3,
            yoyo: true,
            repeat: 1
          });
        });
        
        categoryListEl.appendChild(li);
      });
    }
    
    // æ¸²æŸ“ç½‘ç«™åˆ—è¡¨
    function renderWebsites(websites) {
      if (websites.length === 0) {
        websiteContainerEl.innerHTML = `
          <div class="col-span-full flex justify-center items-center py-20">
            <div class="text-center">
              <i class="fa fa-search text-5xl mb-4" style="color: rgba(255,255,255,0.3);"></i>
              <p class="text-lg mb-2">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç½‘ç«™</p>
              <button id="clear-filters-btn" class="btn-3d rounded-xl px-6 py-3 mt-4">
                æ¸…é™¤ç­›é€‰
              </button>
            </div>
          </div>
        `;
        
        document.getElementById('clear-filters-btn')?.addEventListener('click', () => {
          currentCategory = 'all';
          searchInputEl.value = '';
          const categories = ['all', ...new Set(allWebsites.map(item => item.type))];
          renderCategories(categories);
          categoryTitleEl.innerHTML = `<i class="fa fa-globe mr-3 glow" style="color: #6BBBF7;"></i>æ‰€æœ‰ç½‘ç«™`;
          currentPage = 1;
          filterAndRenderWebsites();
        });
        
        paginationEl.classList.add('hidden');
        return;
      }
      
      // è®¡ç®—åˆ†é¡µ
      const totalPages = Math.ceil(websites.length / itemsPerPage);
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const pagedWebsites = websites.slice(startIndex, endIndex);
      
      // æ›´æ–°åˆ†é¡µä¿¡æ¯
      if (websites.length > itemsPerPage) {
        paginationEl.classList.remove('hidden');
        currentPageEl.textContent = currentPage;
        totalPagesEl.textContent = totalPages;
        
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = currentPage === totalPages;
      } else {
        paginationEl.classList.add('hidden');
      }
      
      // æ¸…ç©ºå®¹å™¨
      websiteContainerEl.innerHTML = '';
      
      // æ ¹æ®è§†å›¾æ¨¡å¼æ¸²æŸ“ç½‘ç«™
      pagedWebsites.forEach((website, index) => {
        const card = createWebsiteCard(website, index);
        websiteContainerEl.appendChild(card);
      });
      
      // æ·»åŠ å¡ç‰‡å…¥åœºåŠ¨ç”»
      gsap.from('.website-card', {
        y: 50,
        opacity: 0,
        duration: 0.6,
        stagger: 0.1,
        ease: 'power3.out',
        onComplete: () => {
          add3DMouseEffects();
        }
      });
    }
    
    // åˆ›å»ºç½‘ç«™å¡ç‰‡
    function createWebsiteCard(website, index) {
      const isFavorite = favorites.some(fav => fav.web === website.web);
      const color = candyColors[index % candyColors.length];
      
      const card = document.createElement('div');
      card.className = `website-card card-3d rounded-2xl overflow-hidden ${
        currentView === 'list' ? 'md:col-span-2' : currentView === 'compact' ? '' : ''
      }`;
      
      // æå–åŸŸå
      let domain = '';
      try {
        let urlStr = website.web;
        if (!urlStr.startsWith('http://') && !urlStr.startsWith('https://')) {
          urlStr = 'https://' + urlStr;
        }
        const url = new URL(urlStr);
        domain = url.hostname.replace('www.', '');
      } catch (e) {
        domain = website.web;
      }
      
      card.innerHTML = `
        <div class="p-6">
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-center">
              <div class="w-12 h-12 rounded-xl flex items-center justify-center mr-4 icon-3d" 
                   style="background: linear-gradient(135deg, ${color}40, ${color}20)">
                <i class="fa fa-globe text-xl" style="color: ${color}"></i>
              </div>
              <div>
                <h3 class="text-lg font-bold mb-1">
                  <a href="${website.web}" target="_blank" rel="noopener noreferrer" 
                     class="hover:text-${color.split('#')[1]}-400 transition-colors">
                    ${website.name}
                  </a>
                </h3>
                <p class="text-sm opacity-75">${domain}</p>
              </div>
            </div>
            <button class="favorite-btn btn-3d rounded-lg p-2 ${
              isFavorite ? 'bg-yellow-500/20 text-yellow-400' : 'bg-gray-800/50 text-gray-400'
            }" data-web="${website.web}">
              <i class="fa ${isFavorite ? 'fa-star' : 'fa-star-o'}"></i>
            </button>
          </div>
          
          <div class="mb-4">
            <span class="inline-block px-3 py-1 rounded-full text-sm bg-gray-800/50">
              ${website.type}
            </span>
          </div>
          
          <p class="text-gray-300 mb-6 line-clamp-2">${website.remark || 'æš‚æ— æè¿°'}</p>
          
          <div class="flex items-center justify-between">
            <a href="${website.web}" target="_blank" rel="noopener noreferrer" 
               class="btn-3d rounded-xl px-6 py-3 flex items-center">
              ç«‹å³è®¿é—®
              <i class="fa fa-external-link ml-2"></i>
            </a>
            <div class="text-xs opacity-50 flex items-center">
              <i class="fa fa-cube mr-1"></i>
              <span>3Då¡ç‰‡</span>
            </div>
          </div>
        </div>
      `;
      
      // æ”¶è—æŒ‰é’®äº‹ä»¶
      card.querySelector('.favorite-btn').addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        toggleFavorite(website, e.target.closest('.favorite-btn'));
      });
      
      return card;
    }
    
    // åˆ‡æ¢æ”¶è—çŠ¶æ€
    function toggleFavorite(website, btn) {
      const index = favorites.findIndex(fav => fav.web === website.web);
      
      if (index === -1) {
        // æ·»åŠ æ”¶è—
        favorites.push(website);
        btn.innerHTML = '<i class="fa fa-star"></i>';
        btn.className = 'favorite-btn btn-3d rounded-lg p-2 bg-yellow-500/20 text-yellow-400';
        
        // 3DåŠ¨ç”»æ•ˆæœ
        gsap.to(btn, {
          scale: 1.3,
          rotationY: 360,
          duration: 0.5,
          ease: 'back.out(1.7)'
        });
        
        showToast(`${website.name} å·²æ·»åŠ åˆ°æ”¶è— â­`, 'success');
      } else {
        // ç§»é™¤æ”¶è—
        favorites.splice(index, 1);
        btn.innerHTML = '<i class="fa fa-star-o"></i>';
        btn.className = 'favorite-btn btn-3d rounded-lg p-2 bg-gray-800/50 text-gray-400';
        
        showToast(`${website.name} å·²ä»æ”¶è—ç§»é™¤`, 'info');
      }
      
      // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
      localStorage.setItem('candyFavorites', JSON.stringify(favorites));
      
      // æ›´æ–°æ”¶è—è®¡æ•°
      updateFavoritesCount();
      
      // å¦‚æœå½“å‰åœ¨æ”¶è—å¤¹é¡µé¢ï¼Œé‡æ–°æ¸²æŸ“
      if (!favoritesModal.classList.contains('hidden')) {
        renderFavorites();
      }
    }
    
    // æ›´æ–°æ”¶è—è®¡æ•°
    function updateFavoritesCount() {
      const count = favorites.length;
      favoritesCountEl.textContent = count;
      
      // åŠ¨ç”»æ•ˆæœ
      if (count > 0) {
        gsap.to(favoritesCountEl, {
          scale: 1.3,
          duration: 0.2,
          yoyo: true,
          repeat: 1
        });
      }
    }
    
    // æ¸²æŸ“æ”¶è—åˆ—è¡¨
    function renderFavorites() {
      if (favorites.length === 0) {
        favoritesContainer.innerHTML = `
          <div class="text-center py-12">
            <i class="fa fa-star text-5xl mb-4" style="color: rgba(255,255,255,0.1);"></i>
            <p class="text-gray-300 mb-2">æ‚¨è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•ç½‘ç«™</p>
            <p class="text-sm text-gray-400">ç‚¹å‡»ç½‘ç«™å¡ç‰‡ä¸Šçš„æ˜Ÿæ˜Ÿå›¾æ ‡æ·»åŠ æ”¶è—</p>
          </div>
        `;
        return;
      }
      
      favoritesContainer.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          ${favorites.map((website, index) => {
            const color = candyColors[index % candyColors.length];
            
            let domain = '';
            try {
              let urlStr = website.web;
              if (!urlStr.startsWith('http://') && !urlStr.startsWith('https://')) {
                urlStr = 'https://' + urlStr;
              }
              const url = new URL(urlStr);
              domain = url.hostname.replace('www.', '');
            } catch (e) {
              domain = website.web;
            }
            
            return `
              <div class="card-3d rounded-2xl p-6">
                <div class="flex items-start justify-between mb-4">
                  <div class="flex items-center">
                    <div class="w-10 h-10 rounded-lg flex items-center justify-center mr-3" 
                         style="background: linear-gradient(135deg, ${color}40, ${color}20)">
                      <i class="fa fa-globe" style="color: ${color}"></i>
                    </div>
                    <div>
                      <h4 class="font-bold">${website.name}</h4>
                      <p class="text-sm opacity-75">${domain}</p>
                    </div>
                  </div>
                  <button class="remove-favorite btn-3d rounded-lg p-2 bg-red-500/20 text-red-400 hover:bg-red-500/30"
                          data-web="${website.web}">
                    <i class="fa fa-times"></i>
                  </button>
                </div>
                
                <p class="text-sm text-gray-300 mb-4 line-clamp-2">${website.remark || 'æš‚æ— æè¿°'}</p>
                
                <div class="flex items-center justify-between">
                  <a href="${website.web}" target="_blank" rel="noopener noreferrer" 
                     class="text-sm btn-3d rounded-lg px-4 py-2">
                    è®¿é—®ç½‘ç«™
                  </a>
                  <span class="text-xs px-3 py-1 rounded-full bg-gray-800/50">${website.type}</span>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      `;
      
      // æ·»åŠ ç§»é™¤æ”¶è—äº‹ä»¶
      favoritesContainer.querySelectorAll('.remove-favorite').forEach(btn => {
        btn.addEventListener('click', () => {
          const web = btn.dataset.web;
          const index = favorites.findIndex(fav => fav.web === web);
          
          if (index !== -1) {
            const websiteName = favorites[index].name;
            favorites.splice(index, 1);
            localStorage.setItem('candyFavorites', JSON.stringify(favorites));
            updateFavoritesCount();
            renderFavorites();
            
            // æ›´æ–°ä¸»é¡µé¢ä¸­çš„æ”¶è—æŒ‰é’®
            document.querySelectorAll(`.favorite-btn[data-web="${web}"]`).forEach(favBtn => {
              favBtn.innerHTML = '<i class="fa fa-star-o"></i>';
              favBtn.className = 'favorite-btn btn-3d rounded-lg p-2 bg-gray-800/50 text-gray-400';
            });
            
            showToast(`${websiteName} å·²ä»æ”¶è—ç§»é™¤`, 'info');
          }
        });
      });
      
      // æ·»åŠ 3Dæ•ˆæœ
      setTimeout(() => {
        add3DMouseEffects();
      }, 100);
    }
    
    // ç­›é€‰å¹¶æ¸²æŸ“ç½‘ç«™
    function filterAndRenderWebsites() {
      let result = [...allWebsites];
      
      // æŒ‰åˆ†ç±»ç­›é€‰
      if (currentCategory !== 'all') {
        result = result.filter(website => website.type === currentCategory);
      }
      
      // æŒ‰æœç´¢è¯ç­›é€‰
      const searchTerm = searchInputEl.value.trim().toLowerCase();
      if (searchTerm) {
        result = result.filter(website => 
          website.name.toLowerCase().includes(searchTerm) || 
          website.remark?.toLowerCase().includes(searchTerm) ||
          website.type.toLowerCase().includes(searchTerm) ||
          website.web.toLowerCase().includes(searchTerm)
        );
      }
      
      // æŒ‰æ’åºæ–¹å¼æ’åº
      const sortBy = sortSelectEl.value;
      if (sortBy === 'name-asc') {
        result.sort((a, b) => a.name.localeCompare(b.name));
      } else if (sortBy === 'name-desc') {
        result.sort((a, b) => b.name.localeCompare(a.name));
      } else if (sortBy === 'random') {
        result = shuffleArray(result);
      }
      
      // æ›´æ–°ç­›é€‰ç»“æœ
      filteredWebsites = result;
      
      // æ›´æ–°æ˜¾ç¤ºæ•°é‡
      displayCountEl.textContent = result.length;
      
      // æ¸²æŸ“ç­›é€‰åçš„ç½‘ç«™
      renderWebsites(result);
    }
    
    // éšæœºæ‰“ä¹±æ•°ç»„
    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }
    
    // æ›´æ–°ç»Ÿè®¡æ•°æ®
    function updateStats() {
      const categories = new Set(allWebsites.map(item => item.type));
      
      totalSitesEl.textContent = allWebsites.length;
      totalCategoriesEl.textContent = categories.size;
      
      // æ•°å­—åŠ¨ç”»
      gsap.from([totalSitesEl, totalCategoriesEl], {
        textContent: 0,
        duration: 1,
        ease: "power2.out",
        snap: { textContent: 1 },
        stagger: 0.2
      });
    }
    
    // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
    function showToast(message, type = 'info') {
      // åˆ›å»ºtoastå…ƒç´ 
      const toast = document.createElement('div');
      toast.className = `fixed top-6 right-6 bg-gray-900/90 backdrop-blur-sm rounded-xl px-6 py-4 flex items-center space-x-3 z-50 transform translate-x-full transition-transform duration-300 border-l-4 ${
        type === 'success' ? 'border-green-500' : 
        type === 'error' ? 'border-red-500' : 
        'border-blue-500'
      }`;
      
      let icon = 'fa-info-circle';
      let iconColor = '#6BBBF7';
      
      if (type === 'success') {
        icon = 'fa-check-circle';
        iconColor = '#6BDE98';
      } else if (type === 'error') {
        icon = 'fa-exclamation-circle';
        iconColor = '#EF476F';
      }
      
      toast.innerHTML = `
        <i class="fa ${icon} text-xl" style="color: ${iconColor}"></i>
        <span>${message}</span>
      `;
      
      document.body.appendChild(toast);
      
      // æ˜¾ç¤ºtoast
      setTimeout(() => {
        toast.classList.remove('translate-x-full');
      }, 10);
      
      // 3ç§’åéšè—
      setTimeout(() => {
        toast.classList.add('translate-x-full');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
    
    // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
    function showError(message) {
      websiteContainerEl.innerHTML = `
        <div class="col-span-full flex justify-center items-center py-20">
          <div class="text-center">
            <i class="fa fa-exclamation-triangle text-5xl mb-4" style="color: #EF476F;"></i>
            <p class="text-lg mb-2">å‡ºé”™äº†</p>
            <p class="text-gray-300 mb-6">${message}</p>
            <button onclick="location.reload()" class="btn-3d rounded-xl px-6 py-3">
              é‡æ–°åŠ è½½
            </button>
          </div>
        </div>
      `;
    }
    
    // æ‰“å¼€æ”¶è—å¤¹
    function openFavorites() {
      renderFavorites();
      favoritesModal.classList.remove('hidden');
      
      setTimeout(() => {
        favoritesModal.classList.add('opacity-100');
        favoritesModal.querySelector('div').classList.remove('scale-95');
        favoritesModal.querySelector('div').classList.add('scale-100');
      }, 10);
      
      document.body.style.overflow = 'hidden';
    }
    
    // å…³é—­æ”¶è—å¤¹
    function closeFavorites() {
      favoritesModal.classList.remove('opacity-100');
      favoritesModal.querySelector('div').classList.remove('scale-100');
      favoritesModal.querySelector('div').classList.add('scale-95');
      
      setTimeout(() => {
        favoritesModal.classList.add('hidden');
        document.body.style.overflow = '';
      }, 300);
    }
    
    // æ·»åŠ äº‹ä»¶ç›‘å¬
    function addEventListeners() {
      // æœç´¢æ¡†äº‹ä»¶
      searchInputEl.addEventListener('input', () => {
        currentPage = 1;
        filterAndRenderWebsites();
      });
      
      // æ’åºé€‰æ‹©äº‹ä»¶
      sortSelectEl.addEventListener('change', () => {
        currentPage = 1;
        filterAndRenderWebsites();
      });
      
      // è§†å›¾åˆ‡æ¢äº‹ä»¶
      viewToggles.forEach(toggle => {
        toggle.addEventListener('click', () => {
          viewToggles.forEach(t => t.classList.remove('bg-gray-800'));
          toggle.classList.add('bg-gray-800');
          
          currentView = toggle.dataset.view;
          
          // æ›´æ–°ç½‘ç«™å®¹å™¨ç±»
          websiteContainerEl.className = '';
          if (currentView === 'grid') {
            websiteContainerEl.classList.add('grid', 'grid-cols-1', 'md:grid-cols-2', 'lg:grid-cols-3', 'gap-6');
          } else if (currentView === 'list') {
            websiteContainerEl.classList.add('grid', 'grid-cols-1', 'gap-6');
          } else if (currentView === 'compact') {
            websiteContainerEl.classList.add('grid', 'grid-cols-2', 'md:grid-cols-3', 'lg:grid-cols-4', 'gap-4');
          }
          
          // é‡æ–°æ¸²æŸ“
          if (filteredWebsites.length > 0) {
            renderWebsites(filteredWebsites);
          }
        });
      });
      
      // åˆ†é¡µæŒ‰é’®äº‹ä»¶
      prevPageBtn.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          renderWebsites(filteredWebsites);
        }
      });
      
      nextPageBtn.addEventListener('click', () => {
        const totalPages = Math.ceil(filteredWebsites.length / itemsPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          renderWebsites(filteredWebsites);
        }
      });
      
      // æ”¶è—å¤¹ç›¸å…³äº‹ä»¶
      favoritesBtn.addEventListener('click', openFavorites);
      clearFavoritesBtn.addEventListener('click', () => {
        if (favorites.length === 0) {
          showToast('æ”¶è—å¤¹å·²ä¸ºç©º', 'info');
          return;
        }
        
        if (confirm(`ç¡®å®šè¦æ¸…ç©º ${favorites.length} ä¸ªæ”¶è—å—ï¼Ÿ`)) {
          favorites = [];
          localStorage.setItem('candyFavorites', JSON.stringify(favorites));
          updateFavoritesCount();
          renderFavorites();
          
          // æ›´æ–°é¡µé¢ä¸­çš„æ”¶è—æŒ‰é’®
          document.querySelectorAll('.favorite-btn').forEach(btn => {
            btn.innerHTML = '<i class="fa fa-star-o"></i>';
            btn.className = 'favorite-btn btn-3d rounded-lg p-2 bg-gray-800/50 text-gray-400';
          });
          
          showToast('æ”¶è—å¤¹å·²æ¸…ç©º', 'info');
        }
      });
      
      // åˆ·æ–°æŒ‰é’®äº‹ä»¶
      refreshBtn.addEventListener('click', () => {
        showToast('æ­£åœ¨åˆ·æ–°æ•°æ®...', 'info');
        loadExcelData();
      });
      
      // 3Dæ•ˆæœåˆ‡æ¢
      toggle3dBtn.addEventListener('click', toggle3DEffects);
      toggleEffectsBtn.addEventListener('click', toggle3DEffects);
      
      // æŒ‰ESCé”®å…³é—­æ”¶è—å¤¹
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !favoritesModal.classList.contains('hidden')) {
          closeFavorites();
        }
      });
      
      // çª—å£æ»šåŠ¨æ•ˆæœ
      window.addEventListener('scroll', () => {
        const scrolled = window.pageYOffset;
        const rate = scrolled * -0.5;
        
        if (is3DEffects) {
          document.querySelectorAll('.card-3d').forEach((card, index) => {
            const speed = 0.5 + (index * 0.1);
            const yPos = -(scrolled * speed * 0.01);
            card.style.transform = `perspective(1000px) translateY(${yPos}px)`;
          });
        }
      });
    }
    
    // å¯åŠ¨åº”ç”¨
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>