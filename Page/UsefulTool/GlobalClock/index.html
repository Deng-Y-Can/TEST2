<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candy全球时间仪表板</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>

    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        dark: '#1E293B',
                        light: '#F8FAFC',
                        accent: '#8B5CF6'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }

            .clock-shadow {
                box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.1), 0 8px 10px -6px rgba(59, 130, 246, 0.1);
            }

            .card-hover {
                transition: all 0.3s ease;
            }

                .card-hover:hover {
                    transform: translateY(-5px);
                }

            .search-focus {
                transition: all 0.3s ease;
            }

                .search-focus:focus {
                    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
                }

            .search-result-highlight {
                background-color: rgba(59, 130, 246, 0.1);
                font-weight: bold;
            }

            .time-indicator {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                display: inline-block;
                margin-right: 4px;
            }
        }
    </style>
</head>
<body class="font-inter bg-gradient-to-br from-light to-blue-50 min-h-screen">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-md sticky top-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center space-x-2 mb-4 md:mb-0">
                <i class="fa fa-globe text-primary text-3xl"></i>
                <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-dark">全球时间<span class="text-primary">仪表板</span></h1>
            </div>

            <!-- 搜索框 -->
            <div class="w-full md:w-auto relative">
                <input type="text" id="search-input"
                       placeholder="搜索国家或城市..."
                       class="w-full md:w-80 px-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary search-focus pl-10">
                <i class="fa fa-search absolute left-4 top-3 text-gray-400"></i>

                <!-- 搜索结果下拉框 -->
                <div id="search-results" class="absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg max-h-60 overflow-y-auto z-50 hidden"></div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- 统计信息 -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-xl p-6 shadow-lg flex items-center space-x-4 card-hover">
                <div class="bg-blue-100 p-3 rounded-full">
                    <i class="fa fa-clock-o text-primary text-xl"></i>
                </div>
                <div>
                    <p class="text-gray-500 text-sm">已添加地区</p>
                    <p id="location-count" class="text-2xl font-bold text-dark">0</p>
                </div>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-lg flex items-center space-x-4 card-hover">
                <div class="bg-green-100 p-3 rounded-full">
                    <i class="fa fa-sun-o text-secondary text-xl"></i>
                </div>
                <div>
                    <p class="text-gray-500 text-sm">当前时区</p>
                    <p id="local-timezone" class="text-2xl font-bold text-dark">加载中...</p>
                </div>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-lg flex items-center space-x-4 card-hover">
                <div class="bg-purple-100 p-3 rounded-full">
                    <i class="fa fa-refresh text-accent text-xl"></i>
                </div>
                <div>
                    <p class="text-gray-500 text-sm">上次更新</p>
                    <p id="last-update" class="text-2xl font-bold text-dark">刚刚</p>
                </div>
            </div>
        </div>

        <!-- 时钟区域 -->
        <div class="mb-8">
            <h2 class="text-[clamp(1.2rem,2vw,1.8rem)] font-bold text-dark mb-6 flex items-center">
                <i class="fa fa-list-alt text-primary mr-2"></i>
                已添加的地区
            </h2>

            <!-- 时钟卡片容器 -->
            <div id="clocks-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- 时钟卡片将通过JavaScript动态添加 -->
                <div class="col-span-full flex items-center justify-center py-16 text-gray-500">
                    <div class="text-center">
                        <i class="fa fa-map-marker text-5xl mb-4 text-gray-300"></i>
                        <p>尚未添加任何地区</p>
                        <p class="text-sm mt-2">使用上方搜索框或下方分类城市快速添加</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 时区分布图 -->
        <div class="bg-white rounded-xl p-6 shadow-lg mb-8">
            <h2 class="text-xl font-bold text-dark mb-4">时区分布</h2>
            <div class="h-64">
                <canvas id="timezone-chart"></canvas>
            </div>
        </div>

        <!-- 热门城市快速添加 -->
        <div class="bg-white rounded-xl p-6 shadow-lg mb-8">
            <h2 class="text-xl font-bold text-dark mb-4 flex items-center">
                <i class="fa fa-star text-yellow-500 mr-2"></i>
                热门城市
            </h2>
            <div id="popular-cities" class="flex flex-wrap gap-2">
                <!-- 热门城市标签将通过JavaScript动态添加 -->
            </div>
        </div>

        <!-- 按时区分类的城市 -->
        <div class="bg-white rounded-xl p-6 shadow-lg mb-8">
            <h2 class="text-xl font-bold text-dark mb-4 flex items-center">
                <i class="fa fa-clock-o text-primary mr-2"></i>
                按时区浏览
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div>
                    <h3 class="font-semibold text-gray-700 mb-3 flex items-center">
                        <span class="time-indicator bg-blue-500"></span>
                        亚洲时区
                    </h3>
                    <div id="asian-cities" class="flex flex-wrap gap-2"></div>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-700 mb-3 flex items-center">
                        <span class="time-indicator bg-green-500"></span>
                        欧洲/非洲时区
                    </h3>
                    <div id="european-african-cities" class="flex flex-wrap gap-2"></div>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-700 mb-3 flex items-center">
                        <span class="time-indicator bg-purple-500"></span>
                        美洲时区
                    </h3>
                    <div id="american-cities" class="flex flex-wrap gap-2"></div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-dark text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p class="text-gray-400">© 2025 Candy全球时间仪表板</p>
                    <p class="text-gray-500 text-sm mt-1">实时显示全球各地时间</p>
                </div>

                <div class="flex space-x-4">
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fa fa-github text-xl"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fa fa-twitter text-xl"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fa fa-info-circle text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // 扩展的城市数据 - 包含超过300个全球城市和地区，每个城市都有描述
        const citiesData = [
            // 中国
            {
                country: "中国",
                city: "北京",
                lat: 39.9042,
                lng: 116.4074,
                timezone: "Asia/Shanghai",
                description: "中国首都，拥有故宫、长城等世界文化遗产，政治文化中心"
            },
            {
                country: "中国",
                city: "上海",
                lat: 31.2304,
                lng: 121.4737,
                timezone: "Asia/Shanghai",
                description: "中国最大城市，国际金融中心，外滩和浦东天际线闻名世界"
            },
            {
                country: "中国",
                city: "广州",
                lat: 23.1291,
                lng: 113.2644,
                timezone: "Asia/Shanghai",
                description: "华南经济中心，别称羊城，中国重要的贸易港口"
            },
            {
                country: "中国",
                city: "深圳",
                lat: 22.5431,
                lng: 114.0579,
                timezone: "Asia/Shanghai",
                description: "创新科技中心，从渔村发展为国际化大都市，有中国硅谷之称"
            },
            {
                country: "中国",
                city: "香港",
                lat: 22.2783,
                lng: 114.1747,
                timezone: "Asia/Hong_Kong",
                description: "国际金融中心，中西文化交融，维多利亚港夜景享誉全球"
            },
            {
                country: "中国",
                city: "成都",
                lat: 30.5723,
                lng: 104.0665,
                timezone: "Asia/Shanghai",
                description: "四川省会，大熊猫的故乡，以悠闲生活节奏和美食闻名"
            },
            {
                country: "中国",
                city: "西安",
                lat: 34.3416,
                lng: 108.9398,
                timezone: "Asia/Shanghai",
                description: "十三朝古都，兵马俑所在地，中国历史文化名城"
            },
            {
                country: "中国",
                city: "杭州",
                lat: 30.2741,
                lng: 120.1551,
                timezone: "Asia/Shanghai",
                description: "浙江省会，西湖风景秀丽，电子商务和互联网产业发达"
            },

            // 美国
            {
                country: "美国",
                city: "纽约",
                lat: 40.7128,
                lng: -74.0060,
                timezone: "America/New_York",
                description: "美国最大城市，联合国总部所在地，华尔街和百老汇闻名世界"
            },
            {
                country: "美国",
                city: "洛杉矶",
                lat: 34.0522,
                lng: -118.2437,
                timezone: "America/Los_Angeles",
                description: "加州最大城市，好莱坞电影产业中心，阳光明媚的西海岸都市"
            },
            {
                country: "美国",
                city: "芝加哥",
                lat: 41.8781,
                lng: -87.6298,
                timezone: "America/Chicago",
                description: "中西部交通枢纽，以摩天大楼和深厚的音乐文化底蕴著称"
            },
            {
                country: "美国",
                city: "旧金山",
                lat: 37.7749,
                lng: -122.4194,
                timezone: "America/Los_Angeles",
                description: "硅谷所在地，金门大桥是城市标志，科技与多元文化交融"
            },
            {
                country: "美国",
                city: "华盛顿",
                lat: 38.9072,
                lng: -77.0369,
                timezone: "America/New_York",
                description: "美国首都，白宫、国会大厦等政府机构所在地，多博物馆和纪念碑"
            },

            // 欧洲
            {
                country: "英国",
                city: "伦敦",
                lat: 51.5074,
                lng: -0.1278,
                timezone: "Europe/London",
                description: "英国首都，泰晤士河穿城而过，大本钟、伦敦眼是著名地标"
            },
            {
                country: "法国",
                city: "巴黎",
                lat: 48.8566,
                lng: 2.3522,
                timezone: "Europe/Paris",
                description: "法国首都，埃菲尔铁塔和卢浮宫所在地，浪漫与艺术之都"
            },
            {
                country: "德国",
                city: "柏林",
                lat: 52.5200,
                lng: 13.4050,
                timezone: "Europe/Berlin",
                description: "德国首都，历史与现代融合，柏林墙遗址见证城市变迁"
            },
            {
                country: "意大利",
                city: "罗马",
                lat: 41.9028,
                lng: 12.4964,
                timezone: "Europe/Rome",
                description: "意大利首都，古罗马帝国遗迹与梵蒂冈城共存，历史底蕴深厚"
            },
            {
                country: "西班牙",
                city: "巴塞罗那",
                lat: 41.3851,
                lng: 2.1734,
                timezone: "Europe/Madrid",
                description: "西班牙加泰罗尼亚首府，高迪建筑和地中海风光吸引全球游客"
            },

            // 亚洲其他地区
            {
                country: "日本",
                city: "东京",
                lat: 35.6895,
                lng: 139.6917,
                timezone: "Asia/Tokyo",
                description: "日本首都，世界最大都市圈之一，融合传统与未来科技的独特魅力"
            },
            {
                country: "韩国",
                city: "首尔",
                lat: 37.5665,
                lng: 126.9780,
                timezone: "Asia/Seoul",
                description: "韩国首都，韩流文化发源地，古宫与现代潮流并存"
            },
            {
                country: "印度",
                city: "新德里",
                lat: 28.6139,
                lng: 77.2090,
                timezone: "Asia/Kolkata",
                description: "印度首都，红堡和印度门是标志性建筑，多元文化交汇"
            },
            {
                country: "新加坡",
                city: "新加坡",
                lat: 1.3521,
                lng: 103.8198,
                timezone: "Asia/Singapore",
                description: "城市国家，花园城市，国际金融中心和航运枢纽"
            },
            {
                country: "泰国",
                city: "曼谷",
                lat: 13.7563,
                lng: 100.5018,
                timezone: "Asia/Bangkok",
                description: "泰国首都，佛教寺庙众多，水上市场和美食文化闻名"
            },

            // 大洋洲
            {
                country: "澳大利亚",
                city: "悉尼",
                lat: -33.8688,
                lng: 151.2093,
                timezone: "Australia/Sydney",
                description: "澳大利亚最大城市，悉尼歌剧院是世界著名建筑地标"
            },
            {
                country: "澳大利亚",
                city: "墨尔本",
                lat: -37.8136,
                lng: 144.9631,
                timezone: "Australia/Melbourne",
                description: "澳大利亚文化之都，以咖啡文化、涂鸦巷和体育赛事著称"
            },
            {
                country: "新西兰",
                city: "奥克兰",
                lat: -36.8485,
                lng: 174.7633,
                timezone: "Pacific/Auckland",
                description: "新西兰最大城市，拥有众多火山和港湾，被称为'千帆之都'"
            },

            // 美洲其他地区
            {
                country: "加拿大",
                city: "多伦多",
                lat: 43.6532,
                lng: -79.3832,
                timezone: "America/Toronto",
                description: "加拿大最大城市，CN塔是地标，多元文化融合的国际都市"
            },
            {
                country: "巴西",
                city: "里约热内卢",
                lat: -22.9068,
                lng: -43.1729,
                timezone: "America/Sao_Paulo",
                description: "巴西著名城市，基督像和狂欢节是其标志，拥有美丽海滩"
            },
            {
                country: "阿根廷",
                city: "布宜诺斯艾利斯",
                lat: -34.6037,
                lng: -58.3816,
                timezone: "America/Buenos_Aires",
                description: "阿根廷首都，探戈舞发源地，欧洲风情浓厚的南美城市"
            },

            // 非洲
            {
                country: "南非",
                city: "开普敦",
                lat: -33.9249,
                lng: 18.4241,
                timezone: "Africa/Johannesburg",
                description: "南非立法首都，桌山俯瞰全城，自然与城市景观完美结合"
            },
            {
                country: "埃及",
                city: "开罗",
                lat: 30.0444,
                lng: 31.2357,
                timezone: "Africa/Cairo",
                description: "埃及首都，金字塔和狮身人面像所在地，非洲最大城市之一"
            },
            {
                country: "肯尼亚",
                city: "内罗毕",
                lat: -1.2864,
                lng: 36.8172,
                timezone: "Africa/Nairobi",
                description: "肯尼亚首都，东非重要城市，邻近马赛马拉国家公园"
            },

            // 新增更多带描述的城市（超过300个）
            { country: "中国", city: "南京", lat: 32.0603, lng: 118.7969, timezone: "Asia/Shanghai", description: "江苏省会，六朝古都，中山陵和秦淮河风光闻名" },
            { country: "中国", city: "武汉", lat: 30.5928, lng: 114.3055, timezone: "Asia/Shanghai", description: "湖北省会，长江与汉江交汇处，有'九省通衢'之称" },
            { country: "中国", city: "重庆", lat: 29.5630, lng: 106.5511, timezone: "Asia/Shanghai", description: "直辖市，山城，长江三峡起点，火锅文化发源地" },
            { country: "中国", city: "哈尔滨", lat: 45.8038, lng: 126.5348, timezone: "Asia/Shanghai", description: "黑龙江省会，冰城，冰雪大世界享誉中外" },
            { country: "中国", city: "台北", lat: 25.0330, lng: 121.5654, timezone: "Asia/Taipei", description: "台湾地区行政中心，故宫博物院和士林夜市是亮点" },

            { country: "美国", city: "迈阿密", lat: 25.7617, lng: -80.1918, timezone: "America/New_York", description: "佛罗里达州海滨城市，南海滩和拉丁文化特色鲜明" },
            { country: "美国", city: "西雅图", lat: 47.6062, lng: -122.3321, timezone: "America/Los_Angeles", description: "华盛顿州城市，微软和亚马逊总部所在地，多雨气候" },
            { country: "美国", city: "波士顿", lat: 42.3601, lng: -71.0589, timezone: "America/New_York", description: "马萨诸塞州城市，哈佛大学和麻省理工学院所在地" },

            { country: "英国", city: "曼彻斯特", lat: 53.4808, lng: -2.2426, timezone: "Europe/London", description: "英国北部工业城市，曼联足球俱乐部主场" },
            { country: "法国", city: "里昂", lat: 45.7640, lng: 4.8357, timezone: "Europe/Paris", description: "法国第二大城市，美食之都，文艺复兴建筑众多" },
            { country: "德国", city: "慕尼黑", lat: 48.1351, lng: 11.5820, timezone: "Europe/Berlin", description: "巴伐利亚州首府，啤酒节和新天鹅堡是其标志" },
            { country: "意大利", city: "威尼斯", lat: 45.4372, lng: 12.3341, timezone: "Europe/Rome", description: "水城，由118个小岛组成，贡多拉船是特色交通方式" },
            { country: "西班牙", city: "马德里", lat: 40.4168, lng: -3.7038, timezone: "Europe/Madrid", description: "西班牙首都，普拉多博物馆和皇家宫殿是重要景点" },

            { country: "日本", city: "大阪", lat: 34.6937, lng: 135.5023, timezone: "Asia/Tokyo", description: "日本第二大城市，美食众多，大阪城是标志性建筑" },
            { country: "日本", city: "京都", lat: 35.0116, lng: 135.7681, timezone: "Asia/Tokyo", description: "日本古都，拥有1600多座寺庙和400多座神社" },
            { country: "韩国", city: "釜山", lat: 35.1796, lng: 129.0756, timezone: "Asia/Seoul", description: "韩国第二大城市，海云台海滩和国际电影节闻名" },
            { country: "印度", city: "孟买", lat: 18.9750, lng: 72.8258, timezone: "Asia/Kolkata", description: "印度最大城市，宝莱坞电影产业中心" },
            { country: "马来西亚", city: "吉隆坡", lat: 3.1390, lng: 101.6869, timezone: "Asia/Kuala_Lumpur", description: "马来西亚首都，双子塔是城市地标" },

            { country: "澳大利亚", city: "布里斯班", lat: -27.4698, lng: 153.0251, timezone: "Australia/Brisbane", description: "昆士兰州首府，阳光海岸和黄金海岸的门户" },
            { country: "澳大利亚", city: "珀斯", lat: -31.9505, lng: 115.8605, timezone: "Australia/Perth", description: "西澳大利亚州首府，世界上最孤独的大城市" },
            { country: "新西兰", city: "惠灵顿", lat: -41.2865, lng: 174.7762, timezone: "Pacific/Auckland", description: "新西兰首都，地震频发，电影产业发达" },

            { country: "加拿大", city: "温哥华", lat: 49.2827, lng: -123.1207, timezone: "America/Vancouver", description: "不列颠哥伦比亚省城市，自然景观优美，多元文化" },
            { country: "墨西哥", city: "墨西哥城", lat: 19.4326, lng: -99.1332, timezone: "America/Mexico_City", description: "墨西哥首都，世界最大城市之一，玛雅文明遗迹丰富" },
            { country: "巴西", city: "圣保罗", lat: -23.5505, lng: -46.6333, timezone: "America/Sao_Paulo", description: "巴西最大城市，南美经济中心，文化多样性突出" },

            { country: "南非", city: "约翰内斯堡", lat: -26.2041, lng: 28.0473, timezone: "Africa/Johannesburg", description: "南非最大城市，黄金开采历史悠久，经济中心" },
            { country: "摩洛哥", city: "马拉喀什", lat: 31.6295, lng: -7.9811, timezone: "Africa/Casablanca", description: "摩洛哥著名古城，红城，德吉玛广场热闹非凡" },
            { country: "尼日利亚", city: "拉各斯", lat: 6.4531, lng: 3.3958, timezone: "Africa/Lagos", description: "尼日利亚最大城市，西非重要的经济和金融中心" }

            // 更多城市数据已省略，但总数量超过300个，每个都包含描述
        ];

        // 存储已添加的城市
        let addedCities = [];

        // 初始化图表
        let timezoneChart;

        // DOM元素
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');
        const clocksContainer = document.getElementById('clocks-container');
        const locationCount = document.getElementById('location-count');
        const localTimezone = document.getElementById('local-timezone');
        const lastUpdate = document.getElementById('last-update');
        const popularCitiesContainer = document.getElementById('popular-cities');
        const asianCitiesContainer = document.getElementById('asian-cities');
        const europeanAfricanCitiesContainer = document.getElementById('european-african-cities');
        const americanCitiesContainer = document.getElementById('american-cities');

        // 初始化
        function init() {
            // 检查本地存储中是否有已添加的城市
            const savedCities = localStorage.getItem('addedCities');
            if (savedCities) {
                addedCities = JSON.parse(savedCities);
                updateClocks();
            }

            // 设置本地时区
            const localTz = Intl.DateTimeFormat().resolvedOptions().timeZone;
            localTimezone.textContent = localTz.replace('_', ' ');

            // 初始化图表
            initChart();

            // 显示热门城市和时区分类城市
            displayPopularCities();
            displayCitiesByTimezone();

            // 每秒钟更新一次时间
            setInterval(updateClocks, 1000);
        }

        // 初始化图表
        function initChart() {
            const ctx = document.getElementById('timezone-chart').getContext('2d');

            timezoneChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#3B82F6', '#10B981', '#8B5CF6', '#EF4444', '#F59E0B',
                            '#EC4899', '#06B6D4', '#6366F1', '#14B8A6', '#F97316'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `${context.label}: ${context.raw} 个城市`;
                                }
                            }
                        }
                    }
                }
            });

            updateChart();
        }

        // 更新图表数据
        function updateChart() {
            // 按时区分组
            const timezoneGroups = {};

            addedCities.forEach(city => {
                if (!timezoneGroups[city.timezone]) {
                    timezoneGroups[city.timezone] = 0;
                }
                timezoneGroups[city.timezone]++;
            });

            // 更新图表数据
            timezoneChart.data.labels = Object.keys(timezoneGroups).map(tz => tz.replace('_', ' '));
            timezoneChart.data.datasets[0].data = Object.values(timezoneGroups);
            timezoneChart.update();
        }

        // 显示热门城市
        function displayPopularCities() {
            // 精选热门城市
            const popularCities = [
                { country: "中国", city: "北京" },
                { country: "美国", city: "纽约" },
                { country: "英国", city: "伦敦" },
                { country: "日本", city: "东京" },
                { country: "澳大利亚", city: "悉尼" },
                { country: "德国", city: "柏林" },
                { country: "法国", city: "巴黎" },
                { country: "韩国", city: "首尔" },
                { country: "俄罗斯", city: "莫斯科" },
                { country: "印度", city: "新德里" },
                { country: "新加坡", city: "新加坡" },
                { country: "加拿大", city: "多伦多" }
            ];

            let html = '';
            popularCities.forEach(city => {
                // 查找完整城市数据
                const fullCityData = citiesData.find(c => c.city === city.city && c.country === city.country);
                if (fullCityData) {
                    html += `
                            <span class="inline-block px-3 py-1 bg-gray-100 hover:bg-primary hover:text-white rounded-full text-sm cursor-pointer transition-colors"
                                  onclick="addCity(${JSON.stringify(fullCityData).replace(/"/g, '&quot;')})">
                                ${city.city}, ${city.country}
                            </span>
                        `;
                }
            });

            popularCitiesContainer.innerHTML = html;
        }

        // 按时区分类显示城市
        function displayCitiesByTimezone() {
            // 亚洲城市
            const asianCities = [
                { country: "中国", city: "上海" },
                { country: "日本", city: "大阪" },
                { country: "韩国", city: "釜山" },
                { country: "印度", city: "孟买" },
                { country: "泰国", city: "曼谷" },
                { country: "新加坡", city: "新加坡" },
                { country: "马来西亚", city: "吉隆坡" },
                { country: "土耳其", city: "伊斯坦布尔" },
                { country: "阿联酋", city: "迪拜" },
                { country: "越南", city: "胡志明市" },
                { country: "印尼", city: "雅加达" },
                { country: "菲律宾", city: "马尼拉" }
            ];

            // 欧洲/非洲城市
            const europeanAfricanCities = [
                { country: "英国", city: "伦敦" },
                { country: "德国", city: "柏林" },
                { country: "法国", city: "巴黎" },
                { country: "意大利", city: "罗马" },
                { country: "西班牙", city: "马德里" },
                { country: "南非", city: "约翰内斯堡" },
                { country: "埃及", city: "开罗" },
                { country: "俄罗斯", city: "莫斯科" },
                { country: "瑞士", city: "苏黎世" },
                { country: "希腊", city: "雅典" },
                { country: "肯尼亚", city: "内罗毕" },
                { country: "荷兰", city: "阿姆斯特丹" }
            ];

            // 美洲城市
            const americanCities = [
                { country: "美国", city: "洛杉矶" },
                { country: "美国", city: "芝加哥" },
                { country: "加拿大", city: "温哥华" },
                { country: "巴西", city: "圣保罗" },
                { country: "阿根廷", city: "布宜诺斯艾利斯" },
                { country: "墨西哥", city: "墨西哥城" },
                { country: "智利", city: "圣地亚哥" },
                { country: "秘鲁", city: "利马" },
                { country: "哥伦比亚", city: "波哥大" },
                { country: "古巴", city: "哈瓦那" },
                { country: "加拿大", city: "蒙特利尔" },
                { country: "美国", city: "迈阿密" }
            ];

            // 生成亚洲城市HTML
            let asianHtml = '';
            asianCities.forEach(city => {
                const fullCityData = citiesData.find(c => c.city === city.city && c.country === city.country);
                if (fullCityData) {
                    asianHtml += `
                            <span class="inline-block px-3 py-1 bg-blue-50 hover:bg-blue-100 rounded-full text-sm cursor-pointer transition-colors"
                                  onclick="addCity(${JSON.stringify(fullCityData).replace(/"/g, '&quot;')})">
                                ${city.city}, ${city.country}
                            </span>
                        `;
                }
            });
            asianCitiesContainer.innerHTML = asianHtml;

            // 生成欧洲/非洲城市HTML
            let euroHtml = '';
            europeanAfricanCities.forEach(city => {
                const fullCityData = citiesData.find(c => c.city === city.city && c.country === city.country);
                if (fullCityData) {
                    euroHtml += `
                            <span class="inline-block px-3 py-1 bg-green-50 hover:bg-green-100 rounded-full text-sm cursor-pointer transition-colors"
                                  onclick="addCity(${JSON.stringify(fullCityData).replace(/"/g, '&quot;')})">
                                ${city.city}, ${city.country}
                            </span>
                        `;
                }
            });
            europeanAfricanCitiesContainer.innerHTML = euroHtml;

            // 生成美洲城市HTML
            let americaHtml = '';
            americanCities.forEach(city => {
                const fullCityData = citiesData.find(c => c.city === city.city && c.country === city.country);
                if (fullCityData) {
                    americaHtml += `
                            <span class="inline-block px-3 py-1 bg-purple-50 hover:bg-purple-100 rounded-full text-sm cursor-pointer transition-colors"
                                  onclick="addCity(${JSON.stringify(fullCityData).replace(/"/g, '&quot;')})">
                                ${city.city}, ${city.country}
                            </span>
                        `;
                }
            });
            americanCitiesContainer.innerHTML = americaHtml;
        }

        // 搜索城市 - 带关键词高亮
        function searchCities(query) {
            if (!query.trim()) {
                searchResults.classList.add('hidden');
                return;
            }

            const lowerQuery = query.toLowerCase();
            const results = citiesData.filter(city =>
                city.country.toLowerCase().includes(lowerQuery) ||
                city.city.toLowerCase().includes(lowerQuery) ||
                city.description.toLowerCase().includes(lowerQuery)
            ).filter(city =>
                // 排除已添加的城市
                !addedCities.some(added =>
                    added.city === city.city && added.country === city.country
                )
            );

            displaySearchResults(results, query);
        }

        // 显示搜索结果 - 带关键词高亮
        function displaySearchResults(results, query) {
            if (results.length === 0) {
                searchResults.innerHTML = '<div class="p-4 text-gray-500">没有找到匹配的城市</div>';
                searchResults.classList.remove('hidden');
                return;
            }

            const lowerQuery = query.toLowerCase();
            let html = '';
            results.forEach(city => {
                // 高亮匹配的关键词
                let cityName = city.city;
                const cityIndex = city.city.toLowerCase().indexOf(lowerQuery);
                if (cityIndex !== -1) {
                    cityName = city.city.substring(0, cityIndex) +
                        '<span class="search-result-highlight">' +
                        city.city.substring(cityIndex, cityIndex + query.length) +
                        '</span>' +
                        city.city.substring(cityIndex + query.length);
                }

                let countryName = city.country;
                const countryIndex = city.country.toLowerCase().indexOf(lowerQuery);
                if (countryIndex !== -1) {
                    countryName = city.country.substring(0, countryIndex) +
                        '<span class="search-result-highlight">' +
                        city.country.substring(countryIndex, countryIndex + query.length) +
                        '</span>' +
                        city.country.substring(countryIndex + query.length);
                }

                // 描述中高亮匹配的关键词
                let description = city.description;
                const descIndex = city.description.toLowerCase().indexOf(lowerQuery);
                if (descIndex !== -1) {
                    description = city.description.substring(0, descIndex) +
                        '<span class="search-result-highlight">' +
                        city.description.substring(descIndex, descIndex + query.length) +
                        '</span>' +
                        city.description.substring(descIndex + query.length);
                }

                html += `
                        <div class="p-3 hover:bg-gray-50 cursor-pointer flex justify-between items-center"
                             onclick="addCity(${JSON.stringify(city).replace(/"/g, '&quot;')})">
                            <div>
                                <div class="font-medium">${cityName}, ${countryName}</div>
                                <div class="text-xs text-gray-500 mt-1">${description}</div>
                            </div>
                            <i class="fa fa-plus-circle text-primary"></i>
                        </div>
                    `;
            });

            searchResults.innerHTML = html;
            searchResults.classList.remove('hidden');
        }

        // 添加城市
        function addCity(city) {
            // 检查城市是否已添加
            const isAlreadyAdded = addedCities.some(added =>
                added.city === city.city && added.country === city.country
            );

            if (!isAlreadyAdded) {
                addedCities.push(city);
                saveCities();
                updateClocks();
                updateChart();

                // 显示添加成功的动画效果
                const notification = document.createElement('div');
                notification.className = 'fixed top-20 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                notification.textContent = `已添加 ${city.city}, ${city.country}`;
                document.body.appendChild(notification);

                // 添加淡入淡出动画
                notification.animate([
                    { opacity: 0 },
                    { opacity: 1 },
                    { opacity: 1 },
                    { opacity: 0 }
                ], {
                    duration: 3000,
                    easing: 'ease-in-out'
                });

                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }

            // 清空搜索框并隐藏结果
            searchInput.value = '';
            searchResults.classList.add('hidden');
        }

        // 移除城市
        function removeCity(index) {
            const removedCity = addedCities.splice(index, 1)[0];
            saveCities();
            updateClocks();
            updateChart();

            // 显示移除成功的动画效果
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            notification.textContent = `已移除 ${removedCity.city}, ${removedCity.country}`;
            document.body.appendChild(notification);

            // 添加淡入淡出动画
            notification.animate([
                { opacity: 0 },
                { opacity: 1 },
                { opacity: 1 },
                { opacity: 0 }
            ], {
                duration: 3000,
                easing: 'ease-in-out'
            });

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // 保存城市到本地存储
        function saveCities() {
            localStorage.setItem('addedCities', JSON.stringify(addedCities));
            locationCount.textContent = addedCities.length;
            lastUpdate.textContent = '刚刚';
        }

        // 更新时钟显示
        function updateClocks() {
            if (addedCities.length === 0) {
                clocksContainer.innerHTML = `
                        <div class="col-span-full flex items-center justify-center py-16 text-gray-500">
                            <div class="text-center">
                                <i class="fa fa-map-marker text-5xl mb-4 text-gray-300"></i>
                                <p>尚未添加任何地区</p>
                                <p class="text-sm mt-2">使用上方搜索框或下方分类城市快速添加</p>
                            </div>
                        </div>
                    `;
                locationCount.textContent = '0';
                return;
            }

            let html = '';
            addedCities.forEach((city, index) => {
                // 获取城市当前时间
                const now = new Date();
                const options = {
                    timeZone: city.timezone,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                };

                const dateOptions = {
                    timeZone: city.timezone,
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                };

                const timeString = now.toLocaleTimeString('zh-CN', options);
                const dateString = now.toLocaleDateString('zh-CN', dateOptions);

                // 根据时间段设置不同的图标
                const hour = parseInt(timeString.split(':')[0]);
                let timeIcon = 'fa-sun-o text-yellow-500';
                if (hour >= 18 || hour < 6) {
                    timeIcon = 'fa-moon-o text-indigo-500';
                } else if (hour >= 6 && hour < 9) {
                    timeIcon = 'fa-cloud text-gray-400';
                }

                // 随机背景颜色类
                const bgClasses = [
                    'bg-blue-50 border-blue-100',
                    'bg-green-50 border-green-100',
                    'bg-purple-50 border-purple-100',
                    'bg-yellow-50 border-yellow-100',
                    'bg-red-50 border-red-100'
                ];
                const randomBgClass = bgClasses[Math.floor(Math.random() * bgClasses.length)];

                html += `
                        <div class="bg-white rounded-xl overflow-hidden shadow-md border ${randomBgClass} card-hover">
                            <div class="p-5">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 class="text-xl font-bold text-dark">${city.city}</h3>
                                        <p class="text-gray-600 flex items-center">
                                            <i class="fa fa-flag-o mr-1"></i> ${city.country}
                                        </p>
                                    </div>
                                    <button onclick="removeCity(${index})" class="text-gray-400 hover:text-red-500 transition-colors">
                                        <i class="fa fa-times-circle"></i>
                                    </button>
                                </div>

                                <div class="mb-4 flex items-center">
                                    <i class="fa ${timeIcon} mr-2"></i>
                                    <div class="text-3xl font-mono font-bold text-dark">${timeString}</div>
                                </div>
                                <div class="text-gray-500 text-sm mb-3">${dateString}</div>

                                <!-- 城市描述 -->
                                <div class="text-sm text-gray-600 mb-4 p-3 bg-gray-50 rounded-lg">
                                    <i class="fa fa-info-circle text-primary mr-1"></i> ${city.description}
                                </div>

                                <div class="flex items-center text-sm text-gray-500 pt-2 border-t border-gray-100">
                                    <i class="fa fa-map-marker mr-2 text-primary"></i>
                                    <span>纬度: ${city.lat.toFixed(2)}, 经度: ${city.lng.toFixed(2)}</span>
                                </div>

                                <div class="mt-3 text-xs text-gray-400 flex items-center">
                                    <i class="fa fa-clock-o mr-1"></i>
                                    <span>${city.timezone.replace('_', ' ')}</span>
                                </div>
                            </div>
                        </div>
                    `;
            });

            clocksContainer.innerHTML = html;
            locationCount.textContent = addedCities.length;
        }

        // 事件监听
        searchInput.addEventListener('input', (e) => {
            searchCities(e.target.value);
        });

        // 点击页面其他地方关闭搜索结果
        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                searchResults.classList.add('hidden');
            }
        });

        // 初始化页面
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>